<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼ä¸šç›´æ’­</title>
    <script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
    <script src="https://download.agora.io/sdk/release/AgoraRTC_N-4.19.0.js"></script>
    <style>
        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #1890ff; margin: 0; }
        .header p { color: #666; margin: 5px 0; }
        .video-container { width: 100%; height: 300px; background: #000; margin: 10px 0; border-radius: 8px; overflow: hidden; position: relative; }
        .video-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; text-align: center; z-index: 10; }
        .controls { margin: 20px 0; text-align: center; }
        .btn { padding: 12px 24px; margin: 8px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; transition: all 0.3s; }
        .btn-primary { background: #1890ff; color: white; }
        .btn-primary:hover { background: #0056b3; }
        .btn-danger { background: #ff4d4f; color: white; }
        .btn-danger:hover { background: #d9363e; }
        .btn-success { background: #52c41a; color: white; }
        .btn-success:hover { background: #389e0d; }
        .btn-share { background: #09bb07; color: white; }
        .btn-share:hover { background: #078d05; }
        .live-list { margin: 20px 0; }
        .live-item { padding: 20px; border: 1px solid #ddd; margin: 15px 0; border-radius: 8px; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        #localVideo, #remoteVideo { width: 100%; height: 100%; object-fit: cover; }
        .page { display: none; }
        .page.active { display: block; }
        .status-bar { padding: 15px; background: white; border-radius: 8px; margin: 15px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .status-item { display: flex; justify-content: space-between; margin: 8px 0; }
        .status-label { color: #666; }
        .status-value { font-weight: bold; color: #1890ff; }
        .wework-tips { background: #e6f7ff; border: 1px solid #91d5ff; border-radius: 8px; padding: 15px; margin: 15px 0; }
        .share-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; display: none; align-items: center; justify-content: center; }
        .share-content { background: white; padding: 30px; border-radius: 12px; text-align: center; max-width: 320px; }
        .share-steps { text-align: left; margin: 20px 0; }
        .share-steps li { margin: 10px 0; padding: 8px; background: #f0f0f0; border-radius: 4px; }
        .copy-success { background: #f6ffed; color: #52c41a; padding: 10px; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <!-- ä¼ä¸šå¾®ä¿¡ç¯å¢ƒæç¤º -->
        <div id="weworkTips" class="wework-tips" style="display:none;">
            <h4>ğŸ¯ ä¼ä¸šå¾®ä¿¡ç¯å¢ƒæ£€æµ‹</h4>
            <p id="envStatus">æ­£åœ¨æ£€æµ‹ä¼ä¸šå¾®ä¿¡ç¯å¢ƒ...</p>
        </div>

        <!-- ç›´æ’­åˆ—è¡¨é¡µ -->
        <div id="listPage" class="page active">
            <div class="header">
                <h1>ğŸ“º ä¼ä¸šç›´æ’­å¹³å°</h1>
                <p>åŸºäºä¼ä¸šå¾®ä¿¡çš„å†…éƒ¨ç›´æ’­è§£å†³æ–¹æ¡ˆ</p>
            </div>
            <div class="controls">
                <button class="btn btn-primary" onclick="createLive()">ğŸ¥ å‘èµ·ç›´æ’­</button>
                <button class="btn btn-success" onclick="refreshList()">ğŸ”„ åˆ·æ–°åˆ—è¡¨</button>
                <button class="btn" onclick="showSettings()">âš™ï¸ è®¾ç½®</button>
            </div>
            <div id="liveList" class="live-list">
                <div class="live-item">
                    <h3>ğŸ’¡ ä½¿ç”¨æŒ‡å—</h3>
                    <p><strong>å‘èµ·ç›´æ’­ï¼š</strong>ç‚¹å‡»"å‘èµ·ç›´æ’­"å¼€å§‹æ¨æµ</p>
                    <p><strong>åˆ†äº«è§‚çœ‹ï¼š</strong>é€šè¿‡ä¼ä¸šå¾®ä¿¡ä¸€é”®åˆ†äº«ç»™åŒäº‹</p>
                    <p><strong>æ— éœ€ä¸‹è½½ï¼š</strong>è§‚ä¼—ç›´æ¥ç‚¹å‡»é“¾æ¥å³å¯è§‚çœ‹</p>
                </div>
                <div class="live-item">
                    <h3>ğŸ“± æ”¯æŒåŠŸèƒ½</h3>
                    <p>âœ… é«˜æ¸…è§†é¢‘ç›´æ’­ âœ… å®æ—¶éŸ³é¢‘ä¼ è¾“</p>
                    <p>âœ… ä¼ä¸šå¾®ä¿¡åˆ†äº« âœ… å¤šäººåŒæ—¶è§‚çœ‹</p>
                    <p>âœ… ç§»åŠ¨ç«¯é€‚é… âœ… ç½‘ç»œè‡ªé€‚åº”</p>
                </div>
            </div>
        </div>

        <!-- ç›´æ’­æ¨æµé¡µ -->
        <div id="pushPage" class="page">
            <div class="header">
                <h1>ğŸ”´ æ­£åœ¨ç›´æ’­</h1>
            </div>
            <div class="video-container">
                <video id="localVideo" autoplay muted></video>
                <div class="video-overlay" id="videoOverlay">
                    <h3>ğŸ“¹ ç‚¹å‡»å¼€å§‹ç›´æ’­</h3>
                    <p>å°†ä¼šè¯·æ±‚æ‘„åƒå¤´å’Œéº¦å…‹é£æƒé™</p>
                </div>
            </div>
            <div class="controls">
                <button id="startBtn" class="btn btn-primary" onclick="startLive()">â–¶ï¸ å¼€å§‹ç›´æ’­</button>
                <button id="stopBtn" class="btn btn-danger" onclick="stopLive()" style="display:none">â¹ï¸ åœæ­¢ç›´æ’­</button>
                <button id="shareBtn" class="btn btn-share" onclick="shareLive()" style="display:none">ğŸ“¤ åˆ†äº«ç»™åŒäº‹</button>
                <button class="btn" onclick="showPage('listPage')">ğŸ”™ è¿”å›åˆ—è¡¨</button>
            </div>
            <div class="status-bar">
                <div class="status-item">
                    <span class="status-label">ç›´æ’­é—´ID:</span>
                    <span class="status-value" id="channelName">æœªåˆ†é…</span>
                </div>
                <div class="status-item">
                    <span class="status-label">ç›´æ’­çŠ¶æ€:</span>
                    <span class="status-value" id="liveStatusHost">å‡†å¤‡ä¸­</span>
                </div>
                <div class="status-item">
                    <span class="status-label">è§‚çœ‹äººæ•°:</span>
                    <span class="status-value" id="audienceCount">0</span>
                </div>
            </div>
        </div>

        <!-- ç›´æ’­è§‚çœ‹é¡µ -->
        <div id="watchPage" class="page">
            <div class="header">
                <h1>ğŸ‘€ è§‚çœ‹ç›´æ’­</h1>
            </div>
            <div class="video-container">
                <video id="remoteVideo" autoplay controls></video>
                <div class="video-overlay" id="watchOverlay">
                    <h3>ğŸ“º ç­‰å¾…è¿æ¥ç›´æ’­</h3>
                    <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åŠ å…¥è§‚çœ‹</p>
                </div>
            </div>
            <div class="controls">
                <button id="joinBtn" class="btn btn-primary" onclick="joinLive()">ğŸ‘ï¸ åŠ å…¥è§‚çœ‹</button>
                <button id="leaveBtn" class="btn btn-danger" onclick="leaveLive()" style="display:none">ğŸšª é€€å‡ºè§‚çœ‹</button>
                <button class="btn btn-share" onclick="shareToColleagues()">ğŸ“¤ åˆ†äº«ç»™å…¶ä»–åŒäº‹</button>
                <button class="btn" onclick="showPage('listPage')">ğŸ”™ è¿”å›åˆ—è¡¨</button>
            </div>
            <div class="status-bar">
                <div class="status-item">
                    <span class="status-label">ç›´æ’­é—´:</span>
                    <span class="status-value" id="watchChannelName">æœªè¿æ¥</span>
                </div>
                <div class="status-item">
                    <span class="status-label">è¿æ¥çŠ¶æ€:</span>
                    <span class="status-value" id="liveStatus">ç­‰å¾…è¿æ¥...</span>
                </div>
            </div>
        </div>

        <!-- åˆ†äº«å¼•å¯¼å¼¹çª— -->
        <div class="share-modal" id="shareModal">
            <div class="share-content">
                <h3>ğŸ“± ä¼ä¸šå¾®ä¿¡åˆ†äº«</h3>
                <div id="shareResult" class="copy-success" style="display:none;">
                    âœ… é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿
                </div>
                <div class="share-steps">
                    <h4>ğŸ“‹ åˆ†äº«æ­¥éª¤ï¼š</h4>
                    <ol>
                        <li>ç‚¹å‡»å³ä¸Šè§’ <strong>Â·Â·Â·</strong> èœå•</li>
                        <li>é€‰æ‹© <strong>å‘é€ç»™åŒäº‹</strong></li>
                        <li>é€‰æ‹©åŒäº‹æˆ–ç¾¤ç»„å‘é€</li>
                        <li>åŒäº‹ç‚¹å‡»é“¾æ¥å³å¯è§‚çœ‹</li>
                    </ol>
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-share" onclick="copyShareLink()">ğŸ“‹ å¤åˆ¶é“¾æ¥</button>
                    <button class="btn" onclick="closeShareModal()">å…³é—­</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é…ç½®ä¿¡æ¯ - è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…é…ç½®
        const AGORA_CONFIG = {
            appId: "e2d14f62ccd74c47a053b74175fa912b", // æ‚¨çš„å£°ç½‘AppID
            token: null // ç®€åŒ–ç‰ˆæœ¬ä¸ä½¿ç”¨token
        };

        // ä¼ä¸šå¾®ä¿¡é…ç½® - è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…é…ç½®
        const WEWORK_CONFIG = {
            corpId: "ww619439206ed8f40e",        // æ›¿æ¢ä¸ºä½ çš„ä¼ä¸šID
            agentId: "1000002"       // æ›¿æ¢ä¸ºä½ çš„åº”ç”¨ID
        };

        // å…¨å±€å˜é‡
        let agoraClient = null;
        let localTracks = [];
        let currentChannel = '';
        let isHost = false;
        let isWeworkEnv = false;
        let shareUrl = '';

        // åº”ç”¨ä¸»ç±»
        class EnterpriseWeworkLive {
            constructor() {
                this.initApp();
            }

            async initApp() {
                console.log('ğŸš€ åˆå§‹åŒ–ä¼ä¸šç›´æ’­åº”ç”¨...');
                
                // æ£€æµ‹è¿è¡Œç¯å¢ƒ
                this.detectEnvironment();
                
                // åˆå§‹åŒ–å£°ç½‘å®¢æˆ·ç«¯
                await this.initAgora();
                
                // åˆå§‹åŒ–ä¼ä¸šå¾®ä¿¡
                if (isWeworkEnv) {
                    await this.initWework();
                }
                
                // æ£€æŸ¥URLå‚æ•°ï¼ˆæ”¯æŒåˆ†äº«é“¾æ¥ç›´æ¥è§‚çœ‹ï¼‰
                this.checkUrlParams();
            }

            detectEnvironment() {
                const ua = navigator.userAgent;
                isWeworkEnv = ua.includes('wxwork') || ua.includes('micromessenger');
                
                const tipsDiv = document.getElementById('weworkTips');
                const statusDiv = document.getElementById('envStatus');
                
                if (isWeworkEnv) {
                    tipsDiv.style.display = 'block';
                    statusDiv.innerHTML = 'âœ… æ£€æµ‹åˆ°ä¼ä¸šå¾®ä¿¡ç¯å¢ƒï¼Œæ”¯æŒä¸€é”®åˆ†äº«åŠŸèƒ½';
                    statusDiv.style.color = '#52c41a';
                } else {
                    tipsDiv.style.display = 'block';
                    statusDiv.innerHTML = 'âš ï¸ éä¼ä¸šå¾®ä¿¡ç¯å¢ƒï¼Œå»ºè®®åœ¨ä¼ä¸šå¾®ä¿¡ä¸­æ‰“å¼€ä»¥è·å¾—æœ€ä½³ä½“éªŒ';
                    statusDiv.style.color = '#faad14';
                }
            }

            async initAgora() {
                try {
                    agoraClient = AgoraRTC.createClient({ mode: "live", codec: "vp8" });
                    
                    // ç›‘å¬è¿œç¨‹ç”¨æˆ·äº‹ä»¶
                    agoraClient.on("user-published", this.handleUserPublished.bind(this));
                    agoraClient.on("user-unpublished", this.handleUserUnpublished.bind(this));
                    agoraClient.on("user-joined", this.handleUserJoined.bind(this));
                    agoraClient.on("user-left", this.handleUserLeft.bind(this));
                    
                    console.log('âœ… å£°ç½‘å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ');
                } catch (error) {
                    console.error('âŒ å£°ç½‘å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥:', error);
                }
            }

            async initWework() {
                try {
                    // ç®€åŒ–ç‰ˆä¼ä¸šå¾®ä¿¡é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒéœ€è¦åç«¯ç­¾åï¼‰
                    if (typeof wx !== 'undefined') {
                        wx.config({
                            beta: true,
                            debug: false, // ç”Ÿäº§ç¯å¢ƒè®¾ä¸ºfalse
                            appId: WEWORK_CONFIG.corpId,
                            timestamp: Math.floor(Date.now() / 1000),
                            nonceStr: Math.random().toString(36).substr(2),
                            signature: 'temp_signature', // å®é™…éœ€è¦åç«¯è®¡ç®—
                            jsApiList: [
                                'updateAppMessageShareData',
                                'updateTimelineShareData',
                                'onMenuShareAppMessage',
                                'chooseImage',
                                'previewImage'
                            ]
                        });

                        wx.ready(() => {
                            console.log('âœ… ä¼ä¸šå¾®ä¿¡JS-SDKåˆå§‹åŒ–æˆåŠŸ');
                            this.setupWeworkShare();
                        });

                        wx.error((res) => {
                            console.log('âš ï¸ ä¼ä¸šå¾®ä¿¡JS-SDKåˆå§‹åŒ–è­¦å‘Š:', res);
                            // å³ä½¿å¤±è´¥ä¹Ÿä¸å½±å“åŸºæœ¬åŠŸèƒ½
                        });
                    }
                } catch (error) {
                    console.log('âš ï¸ ä¼ä¸šå¾®ä¿¡é›†æˆå¤±è´¥ï¼Œå°†ä½¿ç”¨åŸºç¡€åˆ†äº«åŠŸèƒ½:', error);
                }
            }

            checkUrlParams() {
                const urlParams = new URLSearchParams(window.location.search);
                const channel = urlParams.get('channel');
                const mode = urlParams.get('mode');

                if (channel && mode === 'watch') {
                    console.log('ğŸ”— æ£€æµ‹åˆ°åˆ†äº«é“¾æ¥ï¼Œè‡ªåŠ¨è¿›å…¥è§‚çœ‹æ¨¡å¼');
                    this.watchLive(channel);
                }
            }

            // åˆ›å»ºç›´æ’­é—´
            async createLive() {
                const channelName = 'live_' + Date.now();
                currentChannel = channelName;
                isHost = true;
                
                document.getElementById('channelName').textContent = channelName;
                document.getElementById('liveStatusHost').textContent = 'å‡†å¤‡ä¸­';
                showPage('pushPage');
                
                console.log('ğŸ“¡ åˆ›å»ºç›´æ’­é—´:', channelName);
            }

            // å¼€å§‹ç›´æ’­
            async startLive() {
                try {
                    console.log('ğŸ¬ å¼€å§‹ç›´æ’­...');
                    
                    // è®¾ç½®ä¸ºä¸»æ’­è§’è‰²
                    await agoraClient.setClientRole("host");
                    
                    // åˆ›å»ºæœ¬åœ°éŸ³è§†é¢‘è½¨é“
                    localTracks = await AgoraRTC.createMicrophoneAndCameraTracks({
                        videoConfig: {
                            width: 640,
                            height: 480,
                            frameRate: 15,
                            bitrateMin: 300,
                            bitrateMax: 1000
                        },
                        audioConfig: {
                            sampleRate: 48000,
                            stereo: true,
                            bitrate: 128
                        }
                    });
                    
                    const [audioTrack, videoTrack] = localTracks;
                    
                    // æ’­æ”¾æœ¬åœ°è§†é¢‘
                    videoTrack.play('localVideo');
                    
                    // éšè—è¦†ç›–å±‚
                    document.getElementById('videoOverlay').style.display = 'none';
                    
                    // åŠ å…¥é¢‘é“
                    await agoraClient.join(AGORA_CONFIG.appId, currentChannel, AGORA_CONFIG.token);
                    
                    // å‘å¸ƒæœ¬åœ°æµ
                    await agoraClient.publish(localTracks);
                    
                    // æ›´æ–°UI
                    document.getElementById('startBtn').style.display = 'none';
                    document.getElementById('stopBtn').style.display = 'inline-block';
                    document.getElementById('shareBtn').style.display = 'inline-block';
                    document.getElementById('liveStatusHost').textContent = 'ç›´æ’­ä¸­';
                    
                    // ç”Ÿæˆåˆ†äº«é“¾æ¥
                    shareUrl = `${window.location.origin}${window.location.pathname}?channel=${currentChannel}&mode=watch`;
                    
                    console.log('âœ… ç›´æ’­å¼€å§‹æˆåŠŸï¼Œåˆ†äº«é“¾æ¥:', shareUrl);
                    
                } catch (error) {
                    console.error('âŒ å¼€å§‹ç›´æ’­å¤±è´¥:', error);
                    alert('å¼€å§‹ç›´æ’­å¤±è´¥: ' + error.message + '\n\nè¯·æ£€æŸ¥:\n1. ç½‘ç»œè¿æ¥\n2. æ‘„åƒå¤´å’Œéº¦å…‹é£æƒé™\n3. å£°ç½‘é…ç½®');
                    document.getElementById('videoOverlay').style.display = 'block';
                }
            }

            // åœæ­¢ç›´æ’­
            async stopLive() {
                try {
                    // åœæ­¢æœ¬åœ°è½¨é“
                    localTracks.forEach(track => {
                        track.stop();
                        track.close();
                    });
                    localTracks = [];
                    
                    // ç¦»å¼€é¢‘é“
                    await agoraClient.leave();
                    
                    // æ›´æ–°UI
                    document.getElementById('startBtn').style.display = 'inline-block';
                    document.getElementById('stopBtn').style.display = 'none';
                    document.getElementById('shareBtn').style.display = 'none';
                    document.getElementById('liveStatusHost').textContent = 'ç›´æ’­å·²ç»“æŸ';
                    document.getElementById('videoOverlay').style.display = 'block';
                    
                    console.log('â¹ï¸ ç›´æ’­åœæ­¢æˆåŠŸ');
                    
                } catch (error) {
                    console.error('âŒ åœæ­¢ç›´æ’­å¤±è´¥:', error);
                }
            }

            // è§‚çœ‹ç›´æ’­
            async watchLive(channelName = null) {
                if (!channelName) {
                    channelName = prompt('è¯·è¾“å…¥ç›´æ’­é—´ID:');
                    if (!channelName) return;
                }
                
                currentChannel = channelName;
                isHost = false;
                shareUrl = `${window.location.origin}${window.location.pathname}?channel=${currentChannel}&mode=watch`;
                
                document.getElementById('watchChannelName').textContent = channelName;
                showPage('watchPage');
                
                console.log('ğŸ‘€ å‡†å¤‡è§‚çœ‹ç›´æ’­:', channelName);
            }

            // åŠ å…¥è§‚çœ‹
            async joinLive() {
                try {
                    console.log('ğŸ”— è¿æ¥ç›´æ’­é—´...');
                    
                    // è®¾ç½®ä¸ºè§‚ä¼—è§’è‰²
                    await agoraClient.setClientRole("audience");
                    
                    // åŠ å…¥é¢‘é“
                    await agoraClient.join(AGORA_CONFIG.appId, currentChannel, AGORA_CONFIG.token);
                    
                    // æ›´æ–°UI
                    document.getElementById('joinBtn').style.display = 'none';
                    document.getElementById('leaveBtn').style.display = 'inline-block';
                    document.getElementById('liveStatus').textContent = 'å·²è¿æ¥ï¼Œç­‰å¾…ä¸»æ’­...';
                    
                    console.log('âœ… åŠ å…¥ç›´æ’­æˆåŠŸ');
                    
                } catch (error) {
                    console.error('âŒ åŠ å…¥ç›´æ’­å¤±è´¥:', error);
                    alert('åŠ å…¥ç›´æ’­å¤±è´¥: ' + error.message);
                }
            }

            // é€€å‡ºè§‚çœ‹
            async leaveLive() {
                try {
                    await agoraClient.leave();
                    
                    // æ›´æ–°UI
                    document.getElementById('joinBtn').style.display = 'inline-block';
                    document.getElementById('leaveBtn').style.display = 'none';
                    document.getElementById('liveStatus').textContent = 'å·²æ–­å¼€è¿æ¥';
                    document.getElementById('watchOverlay').style.display = 'block';
                    
                    // æ¸…ç©ºè§†é¢‘
                    document.getElementById('remoteVideo').srcObject = null;
                    
                    console.log('ğŸšª é€€å‡ºè§‚çœ‹æˆåŠŸ');
                    
                } catch (error) {
                    console.error('âŒ é€€å‡ºè§‚çœ‹å¤±è´¥:', error);
                }
            }

            // åˆ†äº«ç›´æ’­
            shareLive() {
                console.log('ğŸ“¤ åˆ†äº«ç›´æ’­:', shareUrl);
                this.showShareModal();
                this.copyToClipboard(shareUrl);
            }

            // åˆ†äº«ç»™åŒäº‹
            shareToColleagues() {
                console.log('ğŸ“¤ åˆ†äº«ç»™åŒäº‹:', shareUrl);
                this.showShareModal();
                this.copyToClipboard(shareUrl);
            }

            // æ˜¾ç¤ºåˆ†äº«å¼¹çª—
            showShareModal() {
                document.getElementById('shareModal').style.display = 'flex';
                
                // å¦‚æœåœ¨ä¼ä¸šå¾®ä¿¡ç¯å¢ƒä¸­ï¼Œè®¾ç½®åˆ†äº«ä¿¡æ¯
                if (isWeworkEnv && typeof wx !== 'undefined') {
                    this.setupWeworkShare();
                }
            }

            // å…³é—­åˆ†äº«å¼¹çª—
            closeShareModal() {
                document.getElementById('shareModal').style.display = 'none';
            }

            // å¤åˆ¶åˆ†äº«é“¾æ¥
            copyShareLink() {
                this.copyToClipboard(shareUrl);
                document.getElementById('shareResult').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('shareResult').style.display = 'none';
                }, 3000);
            }

            // è®¾ç½®ä¼ä¸šå¾®ä¿¡åˆ†äº«
            setupWeworkShare() {
                if (typeof wx !== 'undefined') {
                    const title = isHost ? 'æˆ‘æ­£åœ¨ä¼ä¸šç›´æ’­ï¼Œå¿«æ¥è§‚çœ‹ï¼' : 'ç²¾å½©ä¼ä¸šç›´æ’­æ­£åœ¨è¿›è¡Œä¸­';
                    const desc = `ç›´æ’­é—´: ${currentChannel}\nç‚¹å‡»ç«‹å³è§‚çœ‹`;
                    
                    wx.updateAppMessageShareData({
                        title: title,
                        desc: desc,
                        link: shareUrl,
                        imgUrl: window.location.origin + '/favicon.ico',
                        success: () => {
                            console.log('âœ… ä¼ä¸šå¾®ä¿¡åˆ†äº«é…ç½®æˆåŠŸ');
                        },
                        fail: (res) => {
                            console.log('âš ï¸ ä¼ä¸šå¾®ä¿¡åˆ†äº«é…ç½®å¤±è´¥:', res);
                        }
                    });
                }
            }

            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            copyToClipboard(text) {
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(text).then(() => {
                        console.log('ğŸ“‹ é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                    });
                } else {
                    // é™çº§æ–¹æ¡ˆ
                    const textarea = document.createElement('textarea');
                    textarea.value = text;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    console.log('ğŸ“‹ é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼ˆé™çº§æ–¹æ¡ˆï¼‰');
                }
            }

            // å¤„ç†è¿œç¨‹ç”¨æˆ·å‘å¸ƒ
            async handleUserPublished(user, mediaType) {
                console.log('ğŸ‘¤ è¿œç¨‹ç”¨æˆ·å‘å¸ƒ:', user.uid, mediaType);
                await agoraClient.subscribe(user, mediaType);
                
                if (mediaType === 'video') {
                    const remoteVideoTrack = user.videoTrack;
                    remoteVideoTrack.play('remoteVideo');
                    document.getElementById('liveStatus').textContent = 'æ­£åœ¨è§‚çœ‹ç›´æ’­';
                    document.getElementById('watchOverlay').style.display = 'none';
                }
                
                if (mediaType === 'audio') {
                    const remoteAudioTrack = user.audioTrack;
                    remoteAudioTrack.play();
                }
            }

            // å¤„ç†è¿œç¨‹ç”¨æˆ·å–æ¶ˆå‘å¸ƒ
            handleUserUnpublished(user, mediaType) {
                console.log('ğŸ‘¤ è¿œç¨‹ç”¨æˆ·å–æ¶ˆå‘å¸ƒ:', user.uid, mediaType);
                if (mediaType === 'video') {
                    document.getElementById('remoteVideo').srcObject = null;
                    document.getElementById('liveStatus').textContent = 'ä¸»æ’­å·²ç¦»å¼€';
                    document.getElementById('watchOverlay').style.display = 'block';
                }
            }

            // å¤„ç†ç”¨æˆ·åŠ å…¥
            handleUserJoined(user) {
                console.log('ğŸ‘¤ ç”¨æˆ·åŠ å…¥:', user.uid);
                if (isHost) {
                    this.updateAudienceCount();
                }
            }

            // å¤„ç†ç”¨æˆ·ç¦»å¼€
            handleUserLeft(user) {
                console.log('ğŸ‘¤ ç”¨æˆ·ç¦»å¼€:', user.uid);
                if (isHost) {
                    this.updateAudienceCount();
                }
            }

            // æ›´æ–°è§‚ä¼—æ•°é‡
            updateAudienceCount() {
                if (agoraClient && agoraClient.remoteUsers) {
                    const count = agoraClient.remoteUsers.length;
                    document.getElementById('audienceCount').textContent = count;
                }
            }
        }

        // é¡µé¢åˆ‡æ¢å‡½æ•°
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        // å…¨å±€å‡½æ•°ï¼ˆä¾›HTMLè°ƒç”¨ï¼‰
        let app;
        
        window.onload = function() {
            app = new EnterpriseWeworkLive();
        };

        // å¯¼å‡ºå…¨å±€å‡½æ•°
        function createLive() { app.createLive(); }
        function startLive() { app.startLive(); }
        function stopLive() { app.stopLive(); }
        function joinLive() { app.joinLive(); }
        function leaveLive() { app.leaveLive(); }
        function shareLive() { app.shareLive(); }
        function shareToColleagues() { app.shareToColleagues(); }
        function copyShareLink() { app.copyShareLink(); }
        function closeShareModal() { app.closeShareModal(); }

        function refreshList() {
            alert('åŠŸèƒ½æç¤ºï¼š\n\nåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œå¯ä»¥ä»åç«¯APIè·å–ï¼š\nâ€¢ æ­£åœ¨è¿›è¡Œçš„ç›´æ’­åˆ—è¡¨\nâ€¢ å†å²ç›´æ’­å›æ”¾\nâ€¢ é¢„çº¦ç›´æ’­å®‰æ’');
        }

        function showSettings() {
            alert('è®¾ç½®åŠŸèƒ½ï¼š\n\nå¯é…ç½®é¡¹ç›®ï¼š\nâ€¢ è§†é¢‘è´¨é‡è®¾ç½®\nâ€¢ éŸ³é¢‘è´¨é‡è®¾ç½®\nâ€¢ ä¼ä¸šå¾®ä¿¡é›†æˆé…ç½®\nâ€¢ é€šçŸ¥åå¥½è®¾ç½®');
        }
    </script>
</body>
</html>